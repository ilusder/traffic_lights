//******************************************************************************

//    _____ _               _____                        _     _
//   |_   _| |             |  __ \                      | |   (_)
//     | | | |_   _  __ _  | |  | | ___ _ __ _   _  __ _| |__  _ _ __
//     | | | | | | |/ _` | | |  | |/ _ \ '__| | | |/ _` | '_ \| | '_ \
//    _| |_| | |_| | (_| | | |__| |  __/ |  | |_| | (_| | |_) | | | | |
//   |_____|_|\__, |\__,_| |_____/ \___|_|   \__, |\__,_|_.__/|_|_| |_|
//             __/ |                          __/ |
//            |___/                          |___/

//******************************************************************************

#include "mlx90614_driver.h"

//*****************************************************************************
// mlx90614 Device I2C address
//*****************************************************************************
#define MLX90614_ADDR        (0x69 << 1)
#define MLX90614_THEMP       0x01

MLX90632_EE_VERSION

//****************************************************************************
//
//! \brief Read from the MLX90614 with defaults
//!         Reads the CHIP ID.
//!
//! \param[in]    i2cHandle        the handle to the openned i2c device
//!
//! \return 0: Success, < 0: Failure.
//
//****************************************************************************
uint16_t mlx90614GetTemp(I2C_HandleTypeDef * i2cHandle)
{
    uint16_t ucRegVal;

   HAL_StatusTypeDef i2c_status;

    /* Read the temp */
    i2c_status = HAL_I2C_Mem_Read(i2cHandle, MLX90614_ADDR, 
                                  MLX90614_THEMP, I2C_MEMADD_SIZE_8BIT, 
                                 (uint8_t *) &ucRegVal, 2, 
                                 100);
    if(i2c_status == HAL_OK)
    {
        return ucRegVal;
    }
    return(0);
}
